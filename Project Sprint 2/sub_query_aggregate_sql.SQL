#(Subquery)1.Find the total amount spent by each customer
SELECT
    c.customer_id,
    c.first_name,
    c.last_name,
    (
        SELECT SUM(t.amount)
        FROM Rentals r
        JOIN Transactions t ON r.rental_id = t.rental_id
        WHERE r.customer_id = c.customer_id
    ) AS total_spent
FROM Customers c;

#(Subquery)2. List all customers who have rented a console that is currently under maintenance
SELECT
    c.customer_id,
    c.first_name,
    c.last_name
FROM Customers c
WHERE c.customer_id IN (
    SELECT r.customer_id
    FROM Rentals r
    JOIN Consoles con ON r.console_id = con.console_id
    WHERE con.status = 'Maintenance'
);
#(subquery)3. Find the most recent rental details for each customer
SELECT
    c.customer_id,
    c.first_name,
    c.last_name,
    (
        SELECT r.rental_start_date
        FROM Rentals r
        WHERE r.customer_id = c.customer_id
        ORDER BY r.rental_start_date DESC
        LIMIT 1
    ) AS last_rental_date,
    (
        SELECT r.console_id
        FROM Rentals r
        WHERE r.customer_id = c.customer_id
        ORDER BY r.rental_start_date DESC
        LIMIT 1
    ) AS last_rented_console_id
FROM Customers c;

#(aggregate)1.Find the total number of rentals for each customer
SELECT
    c.customer_id,
    c.first_name,
    c.last_name,
    COUNT(r.rental_id) AS total_rentals
FROM Customers c
LEFT JOIN Rentals r ON c.customer_id = r.customer_id
GROUP BY c.customer_id, c.first_name, c.last_name;

#(aggregate)2.Find the average rental cost for each type of console
SELECT
    con.type,
    AVG(r.total_cost) AS average_rental_cost
FROM Consoles con
JOIN Rentals r ON con.console_id = r.console_id
GROUP BY con.type;

#(aggregate)3.Find the total revenue generated by each console model
SELECT
    con.model,
    SUM(t.amount) AS total_revenue
FROM Consoles con
JOIN Rentals r ON con.console_id = r.console_id
JOIN Transactions t ON r.rental_id = t.rental_id
GROUP BY con.model;